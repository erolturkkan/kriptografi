<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSA Asimetrik Åifreleme - Zero Trust</title>
    <link rel="icon" type="image/svg+xml" href="../assets/zt_favicon.svg">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        textarea {
            resize: vertical;
        }
        .btn-action {
            transition: all 0.3s ease;
        }
        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        .btn-action:active {
            transform: translateY(0);
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fadeIn {
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-black text-gray-200 min-h-screen">

    <!-- Header -->
    <header class="bg-gray-800/80 backdrop-blur-xl border-b border-gray-700 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <a href="../index.html" class="flex items-center space-x-2 text-purple-400 hover:text-purple-300 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                    </svg>
                    <span class="font-semibold">Ana Sayfaya DÃ¶n</span>
                </a>
                <div class="flex items-center space-x-2">
                    <img src="../assets/zt (160 x 160 piksel).svg" alt="Zero Trust" class="w-8 h-8 object-contain">
                    
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-7xl">

        <!-- Header and Explanation Section -->
        <header class="text-center mb-10 bg-gradient-to-r from-purple-900/30 to-pink-900/30 backdrop-blur-xl p-6 md:p-8 rounded-2xl shadow-2xl border border-purple-700/30 animate-fadeIn">
            <h1 class="text-3xl md:text-4xl font-bold text-white mb-4">ğŸ” RSA Asimetrik Åifreleme SimÃ¼latÃ¶rÃ¼</h1>
            <div class="text-left mt-6 text-gray-300 max-w-4xl mx-auto space-y-3 text-sm md:text-base">
                <p class="leading-relaxed">
                    Bu araÃ§, modern kriptografinin temel taÅŸlarÄ±ndan olan <strong class="text-purple-400">Asimetrik Kriptografi (AÃ§Ä±k AnahtarlÄ± Åifreleme)</strong> prensibini interaktif olarak gÃ¶stermek iÃ§in tasarlanmÄ±ÅŸtÄ±r.
                </p>
                <div class="bg-gray-900/50 p-4 rounded-lg border border-purple-700/30">
                    <p class="mb-2">
                        <strong class="text-cyan-400">ğŸ¯ AmaÃ§:</strong> Bir mesajÄ±n, alÄ±cÄ±nÄ±n herkesle paylaÅŸabileceÄŸi <strong class="text-green-400">"Public Key" (AÃ§Ä±k Anahtar)</strong> ile nasÄ±l ÅŸifrelendiÄŸini ve bu ÅŸifreli mesajÄ±n <strong class="text-red-400">sadece ve sadece</strong> alÄ±cÄ±nÄ±n kendisinde sakladÄ±ÄŸÄ± <strong class="text-red-400">"Private Key" (Gizli Anahtar)"</strong> ile nasÄ±l deÅŸifre edilebildiÄŸini somut olarak kavramaktÄ±r.
                    </p>
                    <p class="text-purple-300 font-semibold text-sm md:text-base mt-3 p-3 bg-purple-900/20 rounded border-l-4 border-purple-400">
                        ğŸ“‹ Senaryo: Birine gizli bir mesaj gÃ¶ndermek istiyorsunuz. O kiÅŸinin size verdiÄŸi "Public Key" ile mesajÄ±nÄ±zÄ± ÅŸifreleyip gÃ¶nderirsiniz. MesajÄ± yolda ele geÃ§irenler dahi, ellerinde "Private Key" olmadÄ±ÄŸÄ± iÃ§in mesajÄ± okuyamazlar.
                    </p>
                </div>
            </div>
        </header>

        <!-- Main Content Grid -->
        <main class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8 animate-fadeIn">

            <!-- Column 1: Sender -->
            <div class="bg-gradient-to-br from-gray-800/50 to-cyan-900/10 backdrop-blur-xl p-6 rounded-2xl shadow-2xl border border-cyan-700/30 flex flex-col space-y-4">
                <div class="flex items-center justify-between border-b border-cyan-700/30 pb-3">
                    <h2 class="text-xl md:text-2xl font-bold text-cyan-400 flex items-center gap-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"/>
                        </svg>
                        Taraf 1: GÃ¶nderen
                    </h2>
                    <span class="text-xs bg-cyan-900/30 px-3 py-1 rounded-full text-cyan-300">Åifreleme</span>
                </div>
                <p class="text-sm text-gray-400">Bu taraf, alÄ±cÄ±nÄ±n Public Key'ini kullanarak mesajÄ±nÄ± ÅŸifreler.</p>
                
                <div>
                    <label for="receiversPublicKey" class="block text-sm font-medium text-cyan-300 mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                        </svg>
                        AlÄ±cÄ±nÄ±n Public Key'i
                    </label>
                    <textarea id="receiversPublicKey" rows="6" class="w-full p-3 border border-cyan-700/30 rounded-xl bg-gray-900/70 text-gray-300 text-xs font-mono focus:ring-2 focus:ring-cyan-500 focus:outline-none transition-all" readonly placeholder="AlÄ±cÄ± anahtar Ã¼rettiÄŸinde burasÄ± dolacak..."></textarea>
                </div>

                <div>
                    <label for="plaintext" class="block text-sm font-medium text-cyan-300 mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                        GÃ¶nderilecek AÃ§Ä±k Metin
                    </label>
                    <textarea id="plaintext" rows="4" class="w-full p-3 border border-cyan-700/30 rounded-xl bg-gray-800/70 text-gray-100 focus:ring-2 focus:ring-cyan-500 focus:outline-none transition-all" placeholder="Åifrelenecek metni buraya yazÄ±n..."></textarea>
                </div>
                
                <button id="encryptBtn" class="w-full bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-bold py-3 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-cyan-500 btn-action flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                    </svg>
                    MesajÄ± Åifrele ve GÃ¶nder â”
                </button>

                <div>
                    <label for="ciphertext" class="block text-sm font-medium text-cyan-300 mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        GÃ¶nderilen Åifreli Metin (Ciphertext)
                    </label>
                    <textarea id="ciphertext" rows="8" class="w-full p-3 border border-cyan-700/30 rounded-xl bg-gray-900/70 text-cyan-300 text-xs font-mono focus:ring-2 focus:ring-cyan-500 focus:outline-none" readonly placeholder="ÅifrelenmiÅŸ veri burada gÃ¶rÃ¼necek..."></textarea>
                </div>
            </div>

            <!-- Column 2: Receiver -->
            <div class="bg-gradient-to-br from-gray-800/50 to-fuchsia-900/10 backdrop-blur-xl p-6 rounded-2xl shadow-2xl border border-fuchsia-700/30 flex flex-col space-y-4">
                <div class="flex items-center justify-between border-b border-fuchsia-700/30 pb-3">
                    <h2 class="text-xl md:text-2xl font-bold text-fuchsia-400 flex items-center gap-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        Taraf 2: AlÄ±cÄ±
                    </h2>
                    <span class="text-xs bg-fuchsia-900/30 px-3 py-1 rounded-full text-fuchsia-300">DeÅŸifreleme</span>
                </div>
                <p class="text-sm text-gray-400">Bu taraf, kendine Ã¶zel bir anahtar Ã§ifti Ã¼retir ve gelen mesajÄ± Private Key'i ile deÅŸifre eder.</p>

                <button id="generateKeysBtn" class="w-full bg-gradient-to-r from-fuchsia-600 to-purple-600 hover:from-fuchsia-500 hover:to-purple-500 text-white font-bold py-3 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-fuchsia-500 btn-action flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/>
                    </svg>
                    Yeni Anahtar Ã‡ifti Ãœret
                </button>

                <div>
                    <label class="block text-sm font-medium text-green-300 mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"/>
                        </svg>
                        Public Key (GÃ¶nderene Verilir)
                    </label>
                    <textarea id="publicKey" rows="6" class="w-full p-3 border border-green-700/30 rounded-xl bg-gray-900/70 text-green-300 text-xs font-mono focus:ring-2 focus:ring-green-500 focus:outline-none" readonly></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-red-300 mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                        </svg>
                        Private Key (Gizli Tutulur)
                    </label>
                    <textarea id="privateKey" rows="6" class="w-full p-3 border border-red-700/30 rounded-xl bg-gray-900/70 text-red-300 text-xs font-mono focus:ring-2 focus:ring-red-500 focus:outline-none" readonly></textarea>
                </div>
                 <div>
                    <label for="ciphertextToDecrypt" class="block text-sm font-medium text-fuchsia-300 mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 19v-8.93a2 2 0 01.89-1.664l7-4.666a2 2 0 012.22 0l7 4.666A2 2 0 0121 10.07V19M3 19a2 2 0 002 2h14a2 2 0 002-2M3 19l6.75-4.5M21 19l-6.75-4.5M3 10l6.75 4.5M21 10l-6.75 4.5m0 0l-1.14.76a2 2 0 01-2.22 0l-1.14-.76"/>
                        </svg>
                        Gelen Åifreli Mesaj
                    </label>
                    <textarea id="ciphertextToDecrypt" rows="4" class="w-full p-3 border border-fuchsia-700/30 rounded-xl bg-gray-800/70 text-gray-100 focus:ring-2 focus:ring-fuchsia-500 focus:outline-none text-xs font-mono" placeholder="GÃ¶nderenden gelen ÅŸifreli metin..."></textarea>
                </div>
                <div class="space-y-2">
                     <button id="decryptPrivateBtn" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold py-2.5 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 btn-action flex items-center justify-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"/>
                        </svg>
                        âœ“ Private Key ile DeÅŸifre Et
                    </button>
                    <button id="tryDecryptPublicBtn" class="w-full bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 text-black font-bold py-2.5 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 btn-action flex items-center justify-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                        </svg>
                        âœ— Public Key ile Dene (BaÅŸarÄ±sÄ±z Olacak)
                    </button>
                </div>
                <div>
                    <label for="decryptedText" class="block text-sm font-medium text-fuchsia-300 mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        DeÅŸifreleme Sonucu
                    </label>
                    <textarea id="decryptedText" rows="3" class="w-full p-3 border border-fuchsia-700/30 rounded-xl bg-gray-900/70 text-gray-100 font-mono focus:ring-2 focus:ring-fuchsia-500 focus:outline-none" readonly placeholder="DeÅŸifre sonucu burada gÃ¶rÃ¼necek..."></textarea>
                </div>
            </div>
        </main>

        <!-- Info Box -->
        <div class="mt-8 bg-gradient-to-r from-blue-900/20 to-indigo-900/20 backdrop-blur border border-blue-700/30 rounded-xl p-6 animate-fadeIn">
            <h3 class="text-lg font-bold text-blue-400 mb-3 flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                ğŸ’¡ RSA NasÄ±l Ã‡alÄ±ÅŸÄ±r?
            </h3>
            <ul class="text-gray-300 text-sm space-y-2">
                <li class="flex items-start gap-2">
                    <span class="text-green-400 mt-1">âœ“</span>
                    <span><strong class="text-purple-400">Anahtar Ãœretimi:</strong> Matematiksel olarak baÄŸlantÄ±lÄ± iki anahtar (public ve private) Ã¼retilir</span>
                </li>
                <li class="flex items-start gap-2">
                    <span class="text-green-400 mt-1">âœ“</span>
                    <span><strong class="text-cyan-400">Åifreleme:</strong> Public key ile ÅŸifrelenen mesaj sadece private key ile aÃ§Ä±labilir</span>
                </li>
                <li class="flex items-start gap-2">
                    <span class="text-green-400 mt-1">âœ“</span>
                    <span><strong class="text-red-400">GÃ¼venlik:</strong> Public key'i herkes bilse bile, private key olmadan mesaj okunamaz</span>
                </li>
                <li class="flex items-start gap-2">
                    <span class="text-yellow-400 mt-1">âš </span>
                    <span><strong class="text-fuchsia-400">KullanÄ±m AlanlarÄ±:</strong> HTTPS, Email ÅŸifreleme (PGP), Dijital imzalar, VPN baÄŸlantÄ±larÄ±</span>
                </li>
            </ul>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const generateKeysBtn = document.getElementById('generateKeysBtn');
            const encryptBtn = document.getElementById('encryptBtn');
            const tryDecryptPublicBtn = document.getElementById('tryDecryptPublicBtn');
            const decryptPrivateBtn = document.getElementById('decryptPrivateBtn');

            // SENDER elements
            const receiversPublicKeyTextarea = document.getElementById('receiversPublicKey');
            const plaintextInput = document.getElementById('plaintext');
            const ciphertextOutput = document.getElementById('ciphertext');

            // RECEIVER elements
            const publicKeyTextarea = document.getElementById('publicKey');
            const privateKeyTextarea = document.getElementById('privateKey');
            const ciphertextDecryptInput = document.getElementById('ciphertextToDecrypt');
            const decryptedTextOutput = document.getElementById('decryptedText');

            // --- Helper Functions ---
            function arrayBufferToBase64(buffer) {
                let binary = '';
                const bytes = new Uint8Array(buffer);
                bytes.forEach((byte) => binary += String.fromCharCode(byte));
                return window.btoa(binary);
            }

            function base64ToArrayBuffer(base64) {
                const binary_string = window.atob(base64);
                const bytes = new Uint8Array(binary_string.length);
                for (let i = 0; i < binary_string.length; i++) {
                    bytes[i] = binary_string.charCodeAt(i);
                }
                return bytes.buffer;
            }

            // --- Core Crypto Functions ---
            async function generateAndDisplayKeys() {
                try {
                    const keyPair = await window.crypto.subtle.generateKey({
                            name: "RSA-OAEP",
                            modulusLength: 2048,
                            publicExponent: new Uint8Array([1, 0, 1]),
                            hash: "SHA-256",
                        },
                        true,
                        ["encrypt", "decrypt"]
                    );

                    const publicKeyJwk = await window.crypto.subtle.exportKey("jwk", keyPair.publicKey);
                    const privateKeyJwk = await window.crypto.subtle.exportKey("jwk", keyPair.privateKey);
                    
                    const publicKeyString = JSON.stringify(publicKeyJwk, null, 2);
                    publicKeyTextarea.value = publicKeyString;
                    privateKeyTextarea.value = JSON.stringify(privateKeyJwk, null, 2);

                    // Simulate sending public key to the sender
                    receiversPublicKeyTextarea.value = publicKeyString;
                    
                    // Clear all other fields
                    plaintextInput.value = '';
                    ciphertextOutput.value = '';
                    ciphertextDecryptInput.value = '';
                    decryptedTextOutput.value = '';

                } catch (error) {
                    console.error("Key generation failed:", error);
                    decryptedTextOutput.value = "HATA: Anahtar Ã¼retilemedi.";
                }
            }
            
            async function encryptMessage() {
                const plainText = plaintextInput.value;
                const publicKeyString = receiversPublicKeyTextarea.value;

                if (!plainText || !publicKeyString) {
                    ciphertextOutput.value = 'Åifrelemek iÃ§in metin ve alÄ±cÄ± public key\'i gereklidir.';
                    return;
                }

                try {
                    const publicKeyJwk = JSON.parse(publicKeyString);
                    const publicKey = await window.crypto.subtle.importKey("jwk", publicKeyJwk, { name: "RSA-OAEP", hash: "SHA-256" }, true, ["encrypt"]);
                    const encodedMessage = new TextEncoder().encode(plainText);
                    const encryptedBuffer = await window.crypto.subtle.encrypt({ name: "RSA-OAEP" }, publicKey, encodedMessage);

                    const base64Ciphertext = arrayBufferToBase64(encryptedBuffer);
                    ciphertextOutput.value = base64Ciphertext;
                    
                    // Simulate sending the ciphertext to the receiver
                    ciphertextDecryptInput.value = base64Ciphertext;
                    decryptedTextOutput.value = ''; // Clear previous results

                } catch (error) {
                    console.error("Encryption failed:", error);
                    ciphertextOutput.value = "[ÅÄ°FRELEME BAÅARISIZ]";
                }
            }

            async function decryptMessage(usePrivateKey = true) {
                const base64Ciphertext = ciphertextDecryptInput.value;
                if (!base64Ciphertext) {
                    decryptedTextOutput.value = 'DeÅŸifre edilecek veri yok.';
                    return;
                }

                try {
                    const keyJwkString = usePrivateKey ? privateKeyTextarea.value : publicKeyTextarea.value;
                    if (!keyJwkString) {
                         decryptedTextOutput.value = "HATA: Ä°ÅŸlem iÃ§in anahtar bulunamadÄ±.";
                         return;
                    }
                    const keyJwk = JSON.parse(keyJwkString);
                    // Decryption must be tried with a key that has "decrypt" usage.
                    const keyToUse = await window.crypto.subtle.importKey("jwk", keyJwk, { name: "RSA-OAEP", hash: "SHA-256" }, true, ["decrypt"]);
                    
                    const encryptedBuffer = base64ToArrayBuffer(base64Ciphertext);
                    const decryptedBuffer = await window.crypto.subtle.decrypt({ name: "RSA-OAEP" }, keyToUse, encryptedBuffer);
                    const decryptedText = new TextDecoder().decode(decryptedBuffer);
                    
                    decryptedTextOutput.value = `âœ… BAÅARILI:\n\n${decryptedText}`;
                    decryptedTextOutput.classList.remove('text-red-400');
                    decryptedTextOutput.classList.add('text-green-400');

                } catch (error) {
                    console.error(`Decryption attempt with ${usePrivateKey ? 'private' : 'public'} key failed:`, error);
                    const failureReason = usePrivateKey 
                        ? "KullanÄ±lan Private Key yanlÄ±ÅŸ veya veri bozuk." 
                        : "Public Key deÅŸifreleme iÅŸlemi iÃ§in kullanÄ±lamaz.";
                    decryptedTextOutput.value = `âŒ BAÅARISIZ:\n\n${failureReason}`;
                    decryptedTextOutput.classList.remove('text-green-400');
                    decryptedTextOutput.classList.add('text-red-400');
                }
            }

            // --- Event Listeners ---
            generateKeysBtn.addEventListener('click', generateAndDisplayKeys);
            encryptBtn.addEventListener('click', encryptMessage);
            tryDecryptPublicBtn.addEventListener('click', () => decryptMessage(false));
            decryptPrivateBtn.addEventListener('click', () => decryptMessage(true));

            // --- Initialisation ---
            generateAndDisplayKeys();
        });
    </script>

</body>
</html>

